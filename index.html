<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Stock Ticker</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: transparent;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }

        .ticker-container {
            width: 100%;
            height: 80px;
            background: linear-gradient(45deg, #1a1a2e, #16213e);
            border-top: 2px solid #0f3460;
            border-bottom: 2px solid #0f3460;
            overflow: hidden;
            position: relative;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        .ticker-content {
            display: flex;
            align-items: center;
            height: 100%;
            animation: scroll-left 45s linear infinite;
            white-space: nowrap;
        }

        @keyframes scroll-left {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        .stock-item {
            display: inline-flex;
            align-items: center;
            margin-right: 25px;
            padding: 8px 12px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            backdrop-filter: blur(5px);
            min-width: 160px;
            flex-shrink: 0;
        }

        .news-item {
            display: inline-flex;
            align-items: center;
            margin-right: 30px;
            padding: 10px 16px;
            background: linear-gradient(45deg, rgba(255,69,0,0.3), rgba(255,140,0,0.2));
            border-radius: 8px;
            backdrop-filter: blur(5px);
            min-width: 350px;
            border-left: 4px solid #ff4500;
            flex-shrink: 0;
        }

        .stock-symbol {
            font-weight: bold;
            color: #ffffff;
            font-size: 15px;
            margin-right: 6px;
        }

        .stock-price {
            color: #00d4ff;
            font-size: 13px;
            margin-right: 6px;
        }

        .stock-change {
            font-size: 11px;
            font-weight: bold;
            padding: 2px 5px;
            border-radius: 4px;
        }

        .positive {
            color: #00ff88;
            background: rgba(0,255,136,0.2);
        }

        .negative {
            color: #ff4757;
            background: rgba(255,71,87,0.2);
        }

        .news-icon {
            color: #ff4500;
            margin-right: 8px;
            font-size: 16px;
        }

        .news-text {
            color: #ffffff;
            font-size: 14px;
            font-weight: 500;
        }

        .market-status {
            position: absolute;
            left: 10px;
            bottom: 5px;
            background: rgba(0,0,0,0.9);
            color: #ffffff;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 11px;
            z-index: 100;
            white-space: nowrap;
        }

        .crypto-badge {
            background: linear-gradient(45deg, #f7931a, #ffb347);
            color: #000;
            font-size: 9px;
            padding: 1px 3px;
            border-radius: 3px;
            margin-left: 3px;
        }

        .etf-badge {
            background: linear-gradient(45deg, #32cd32, #90ee90);
            color: #000;
            font-size: 9px;
            padding: 1px 3px;
            border-radius: 3px;
            margin-left: 3px;
        }

        .loading {
            color: #ffffff;
            text-align: center;
            padding: 30px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="ticker-container">
        <div class="ticker-content" id="tickerContent">
            <div class="loading">📈 Loading live data from server...</div>
        </div>
        <div class="market-status" id="marketStatus">•••</div>
    </div>

    <script>
        class LiveTicker {
            constructor() {
                this.serverIP = '147.93.7.31'; // Your server IP
                this.tickerContent = document.getElementById('tickerContent');
                this.marketStatus = document.getElementById('marketStatus');
                this.newsIndex = 0;
                
                this.symbols = [
                    'AAPL', 'GOOGL', 'MSFT', 'AMZN', 'TSLA', 'NVDA', 'META', 'NFLX',
                    'BTC-USD', 'ETH-USD', 'BNB-USD', 'XRP-USD', 'ADA-USD', 'SOL-USD',
                    'SPY', 'QQQ', 'DIA', 'GLD'
                ];
                
                this.news = [
                    "📊 S&P 500 reaches new highs as tech stocks surge",
                    "🚀 Tesla announces breakthrough in battery technology", 
                    "💰 Federal Reserve maintains interest rates",
                    "📱 Apple unveils new AI features",
                    "⚡ NVIDIA stock soars on AI demand",
                    "💎 Bitcoin hits new monthly high",
                    "🌐 Microsoft expands cloud services",
                    "🔋 Clean energy stocks gain momentum"
                ];
                
                this.init();
            }

            async init() {
                await this.updateTicker();
                setInterval(() => this.updateTicker(), 60000); // Update every minute
                this.updateMarketStatus();
                setInterval(() => this.updateMarketStatus(), 60000);
            }

            async fetchFromServer(symbol) {
                try {
                    const response = await fetch(`http://${this.serverIP}:5000/api/stock/${symbol}`);
                    const data = await response.json();
                    return data;
                } catch (error) {
                    console.log(`Server fetch failed for ${symbol}, using fallback`);
                    return this.getFallbackData(symbol);
                }
            }

            getFallbackData(symbol) {
                const fallbackData = {
                    'AAPL': { price: 185.25, change: 2.15 },
                    'GOOGL': { price: 2801.50, change: -12.30 },
                    'BTC-USD': { price: 67890.00, change: 1250.00 },
                    'ETH-USD': { price: 3456.78, change: 89.12 },
                    'SPY': { price: 485.30, change: 3.25 }
                };
                
                const data = fallbackData[symbol] || { price: 100.0, change: 1.0 };
                const changePercent = (data.change / data.price) * 100;
                
                return {
                    symbol: symbol,
                    price: data.price,
                    change: data.change,
                    changePercent: changePercent.toFixed(2)
                };
            }

            async updateTicker() {
                console.log('Fetching live data from server...');
                
                const items = [];
                
                // Fetch data for all symbols
                for (let i = 0; i < this.symbols.length; i++) {
                    const symbol = this.symbols[i];
                    const data = await this.fetchFromServer(symbol);
                    
                    const changeClass = data.change >= 0 ? 'positive' : 'negative';
                    const changeSymbol = data.change >= 0 ? '+' : '';
                    
                    let badge = '';
                    let displaySymbol = symbol;
                    
                    if (symbol.includes('-USD')) {
                        badge = '<span class="crypto-badge">CRYPTO</span>';
                        displaySymbol = symbol.replace('-USD', '');
                    } else if (['SPY', 'QQQ', 'DIA', 'GLD'].includes(symbol)) {
                        badge = '<span class="etf-badge">ETF</span>';
                    }
                    
                    items.push(`
                        <div class="stock-item">
                            <span class="stock-symbol">${displaySymbol}${badge}</span>
                            <span class="stock-price">$${data.price}</span>
                            <span class="stock-change ${changeClass}">
                                ${changeSymbol}${data.change} (${changeSymbol}${data.changePercent}%)
                            </span>
                        </div>
                    `);
                    
                    // Add news after every 6 items
                    if ((i + 1) % 6 === 0) {
                        items.push(`
                            <div class="news-item">
                                <span class="news-icon">📰</span>
                                <span class="news-text">${this.news[this.newsIndex % this.news.length]}</span>
                            </div>
                        `);
                        this.newsIndex++;
                    }
                }
                
                console.log('Live data loaded successfully!');
                
                // Create seamless loop
                const content = items.join('');
                this.tickerContent.innerHTML = content + content + content;
            }

            updateMarketStatus() {
                const now = new Date();
                const timeStr = now.toLocaleTimeString('en-US', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    timeZone: 'America/New_York'
                });
                
                const status = `🔄 LIVE DATA • ${timeStr} EST`;
                this.marketStatus.textContent = status;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            console.log('Starting Live Ticker with server data...');
            new LiveTicker();
        });
    </script>
</body>
</html>
